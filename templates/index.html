{% extends "base.html" %}

{% block title %}YT BoardGame - Canales de Juegos de Mesa e IA{% endblock %}
{% block canonical_path %}index.html{% endblock %}
{% block og_url_path %}index.html{% endblock %}
{% block twitter_url_path %}index.html{% endblock %}


{% block content %}
    <header class="header">
        <h1>🎲 YT BoardGame</h1>
        <p>Directorio curado de canales de YouTube sobre juegos de mesa e inteligencia artificial</p>
        <div class="last-update">📅 Última actualización: {{ last_update }}</div>
    </header>

    <div class="stats">
        <div class="stat-item">
            <span class="stat-number">{{ total_channels }}</span>
            <span class="stat-label">Total de Canales</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ total_videos }}</span>
            <span class="stat-label">Videos Recientes</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ channels_ingles_count }}</span>
            <span class="stat-label">Canales en Inglés</span>
        </div>
        <div class="stat-item">
            <span class="stat-number">{{ channels_espanol_count }}</span>
            <span class="stat-label">Canales en Español</span>
        </div>
    </div>

    <main>
        {% for idioma, canales in channels_data.items() %}
            {% if canales %}
                {% set flag = "🇺🇸" if idioma == "ingles" else "🇪🇸" %}
                {% set idioma_titulo = "Inglés" if idioma == "ingles" else "Español" %}
                
                <section class="language-section">
                    <div class="language-header">
                        <h2 class="language-title">{{ flag }} Canales en {{ idioma_titulo }}</h2>
                    </div>
                    <div class="channels-grid">
                        {% for nombre_canal, channel_info in canales.items() %}
                            {% set url_canal = channel_info.url %}
                            {% set logo_url = channel_info.logo_url | default('https://via.placeholder.com/60?text=Logo') %}
                            {% set channel_id = channel_info.channel_id %}
                            {% set channel_youtube_url = "https://www.youtube.com/channel/" ~ channel_id if channel_id else url_canal %}

                            {% set videos_canal = videos_data.get(idioma, {}).get(nombre_canal, []) %}
                            {% set num_videos = videos_canal | length %}
                            
                            <a href="{{ channel_youtube_url }}" target="_blank" class="channel-card">
                                <img src="{{ logo_url }}" alt="Logo de {{ nombre_canal }}" class="channel-logo">
                                <div class="channel-name">{{ nombre_canal }}</div>
                                <div class="channel-url">{{ url_canal.replace('https://www.youtube.com/@', '@') }}</div>
                                <div class="videos-info">
                                    📹 {{ num_videos }} videos recientes
                                </div>
                                <div class="videos-list" data-full-count="{{ num_videos }}">
                                    {% if videos_canal %}
                                        {% for video in videos_canal %}
                                            {% set views_str = format_views(video.visualizaciones | default(0)) %}
                                            <a href="https://www.youtube.com/watch?v={{ video.id }}" target="_blank" class="video-item">
                                                <img src="{{ video.thumbnail_url | default('https://via.placeholder.com/120x90?text=Video') }}" alt="Miniatura de {{ video.titulo }}" class="video-thumbnail">
                                                <div class="video-details">
                                                    <div class="video-title">{{ video.titulo | default('Sin título') }}</div>
                                                    <div class="video-meta">
                                                        <span>👁️ {{ views_str }} vistas</span>
                                                        <span>📅 {{ video.fecha_subida | default('N/A') }}</span>
                                                    </div>
                                                </div>
                                            </a>
                                        {% endfor %}
                                    {% else %}
                                        <div class="video-item no-videos">No hay videos recientes disponibles.</div>
                                    {% endif %}
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </section>
            {% endif %}
        {% endfor %}
    </main>
{% endblock %}